<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecossistema Invistto - Diagrama Interativo</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: system-ui, -apple-system, sans-serif; }
        #graph { width: 100vw; height: 100vh; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        .node { cursor: pointer; }
        .node circle { stroke: #fff; stroke-width: 2px; }
        .node text { fill: white; font-size: 10px; font-weight: 500; }
        .link { stroke: #475569; stroke-opacity: 0.6; stroke-width: 1.5px; }
        .tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            max-width: 280px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .tooltip h3 { margin: 0 0 8px 0; color: #60a5fa; font-size: 14px; }
        .tooltip p { margin: 4px 0; color: #94a3b8; }
        .tooltip .port { color: #10b981; font-family: monospace; }
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(15, 23, 42, 0.9);
            border-radius: 8px;
            padding: 16px;
            color: white;
        }
        .legend-item { display: flex; align-items: center; gap: 8px; margin: 6px 0; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        .header {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
        }
        .header h1 { font-size: 24px; margin: 0; }
        .header p { color: #94a3b8; margin: 4px 0 0 0; font-size: 12px; }
        .stats {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 12px;
        }
        .stat {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 8px;
            padding: 12px 16px;
            color: white;
            text-align: center;
        }
        .stat-value { font-size: 24px; font-weight: bold; color: #3b82f6; }
        .stat-label { font-size: 10px; color: #94a3b8; text-transform: uppercase; }
    </style>
</head>
<body>
    <div id="graph"></div>

    <a href="DIAGRAMA-HIERARQUIA.html" style="position:fixed;top:20px;right:20px;background:#10b981;color:white;padding:10px 20px;border-radius:8px;text-decoration:none;font-size:14px;z-index:1000;">Vis√£o Hier√°rquica ‚Üí</a>

    <div class="header">
        <h1>üèóÔ∏è Ecossistema Invistto</h1>
        <p>Diagrama interativo - Arraste os n√≥s para reorganizar</p>
    </div>

    <div class="stats">
        <div class="stat">
            <div class="stat-value">12</div>
            <div class="stat-label">Projetos Ativos</div>
        </div>
        <div class="stat">
            <div class="stat-value">15</div>
            <div class="stat-label">Portas em Uso</div>
        </div>
        <div class="stat">
            <div class="stat-value">3</div>
            <div class="stat-label">Bancos de Dados</div>
        </div>
    </div>

    <div class="legend">
        <div class="legend-item"><div class="legend-dot" style="background: #3b82f6"></div> Hub Central</div>
        <div class="legend-item"><div class="legend-dot" style="background: #ef4444"></div> Autentica√ß√£o</div>
        <div class="legend-item"><div class="legend-dot" style="background: #10b981"></div> Frontend</div>
        <div class="legend-item"><div class="legend-dot" style="background: #8b5cf6"></div> Backend API</div>
        <div class="legend-item"><div class="legend-dot" style="background: #f59e0b"></div> Servi√ßo</div>
        <div class="legend-item"><div class="legend-dot" style="background: #6366f1"></div> Banco de Dados</div>
        <div class="legend-item"><div class="legend-dot" style="background: #94a3b8"></div> Externo</div>
    </div>

    <div id="tooltip" class="tooltip" style="display: none;"></div>

    <script>
        const nodes = [{"id": 0, "name": "Invistto Hub", "key": "invistto-hub", "type": "frontend", "port": 5173, "desc": "SSO Gateway Central", "stack": "React 19.2.0 + Vite", "color": "#3b82f6", "path": "/hub/"}, {"id": 1, "name": "Auth API", "key": "invistto-auth", "type": "backend", "port": 3001, "desc": "Autentica\u00e7\u00e3o Centralizada", "stack": "NestJS 10 + MySQL", "color": "#ef4444", "path": ""}, {"id": 2, "name": "Admin Panel", "key": "admin-panel-frontend", "type": "frontend", "port": 5173, "desc": "Painel Administrativo", "stack": "React 18.3.1 + Vite", "color": "#10b981", "path": "/admin/"}, {"id": 3, "name": "Admin API", "key": "admin-panel-api", "type": "backend", "port": 3002, "desc": "Backend Admin", "stack": "NestJS 10 + Prisma", "color": "#8b5cf6", "path": ""}, {"id": 4, "name": "Courier Analytics", "key": "courier-frontend", "type": "frontend", "port": 3008, "desc": "Dashboard WhatsApp", "stack": "React 19.2.3 + TanStack Query", "color": "#10b981", "path": "/courier/"}, {"id": 5, "name": "Courier API", "key": "courier-api", "type": "backend", "port": 3333, "desc": "29 Endpoints Analytics", "stack": "NestJS 10 + Prisma + Firebird", "color": "#8b5cf6", "path": ""}, {"id": 6, "name": "Invistto BI", "key": "invistto-bi", "type": "frontend", "port": 3007, "desc": "Business Intelligence", "stack": "React 19.1.0 + Recharts", "color": "#10b981", "path": "/bi/"}, {"id": 7, "name": "ARI Analytics", "key": "ari", "type": "backend", "port": 3010, "desc": "API de BI (11 m\u00f3dulos)", "stack": "NestJS 11 + Knex.js", "color": "#8b5cf6", "path": ""}, {"id": 8, "name": "Zeiss Client", "key": "zeiss-frontend", "type": "frontend", "port": 3006, "desc": "Integra\u00e7\u00e3o Carl Zeiss", "stack": "React 19.1.0 + MUI", "color": "#10b981", "path": "/zeiss/"}, {"id": 9, "name": "Zeiss API", "key": "zeiss-api", "type": "backend", "port": 3005, "desc": "Cat\u00e1logo e Pedidos Zeiss", "stack": "NestJS 10 + MySQL + Firebird", "color": "#8b5cf6", "path": ""}, {"id": 10, "name": "OlhoVivo Lens", "key": "lens-frontend", "type": "frontend", "port": 3009, "desc": "Hub Multi-Laborat\u00f3rio", "stack": "React 19.1.0 + TanStack Query", "color": "#10b981", "path": "/lentes/"}, {"id": 11, "name": "Lens API", "key": "lens-api", "type": "backend", "port": 3015, "desc": "Consolida\u00e7\u00e3o de Cat\u00e1logos", "stack": "NestJS 10 + Prisma + Firebird", "color": "#8b5cf6", "path": ""}, {"id": 12, "name": "API Invistto", "key": "api-invistto", "type": "backend", "port": 3000, "desc": "CRM Pontomarket", "stack": "NestJS 10 + MySQL", "color": "#8b5cf6", "path": ""}, {"id": 13, "name": "ServerMCP", "key": "servermcp", "type": "service", "port": 3002, "desc": "Gateway Claude Desktop", "stack": "Express.js + Redis", "color": "#f59e0b", "path": ""}, {"id": 14, "name": "Sales API", "key": "sales-api", "type": "backend", "port": 3011, "desc": "Vendas \u00d3ticas", "stack": "NestJS 11 + Firebird", "color": "#8b5cf6", "path": ""}, {"id": 15, "name": "MySQL Principal", "key": "mysql-main", "type": "database", "port": 3305, "desc": "Banco centralizado", "stack": "", "color": "#6366f1", "path": ""}, {"id": 16, "name": "Firebird ERPs", "key": "firebird", "type": "database", "port": 3307, "desc": "Bancos legados ERP", "stack": "", "color": "#6366f1", "path": ""}, {"id": 17, "name": "Redis Cache", "key": "redis", "type": "database", "port": 6379, "desc": "Cache e Filas", "stack": "", "color": "#6366f1", "path": ""}, {"id": 18, "name": "Zeiss SAO API", "key": "zeiss-sao-api", "type": "external", "port": "", "desc": "API Externa Carl Zeiss", "stack": "", "color": "#94a3b8", "path": ""}];
        const links = [{"source": 0, "target": 1}, {"source": 1, "target": 15}, {"source": 2, "target": 1}, {"source": 2, "target": 3}, {"source": 3, "target": 15}, {"source": 4, "target": 1}, {"source": 4, "target": 5}, {"source": 5, "target": 15}, {"source": 5, "target": 16}, {"source": 6, "target": 1}, {"source": 6, "target": 7}, {"source": 7, "target": 15}, {"source": 7, "target": 13}, {"source": 8, "target": 1}, {"source": 8, "target": 9}, {"source": 9, "target": 15}, {"source": 9, "target": 16}, {"source": 9, "target": 17}, {"source": 9, "target": 18}, {"source": 10, "target": 1}, {"source": 10, "target": 11}, {"source": 11, "target": 15}, {"source": 11, "target": 16}, {"source": 12, "target": 15}, {"source": 12, "target": 17}, {"source": 13, "target": 7}, {"source": 13, "target": 17}, {"source": 14, "target": 16}, {"source": 14, "target": 15}];

        const width = window.innerWidth;
        const height = window.innerHeight;

        const svg = d3.select("#graph")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Definir setas
        svg.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "-0 -5 10 10")
            .attr("refX", 25)
            .attr("refY", 0)
            .attr("orient", "auto")
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .append("path")
            .attr("d", "M 0,-5 L 10,0 L 0,5")
            .attr("fill", "#475569");

        // For√ßa de simula√ß√£o
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(150))
            .force("charge", d3.forceManyBody().strength(-400))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(50));

        // Links
        const link = svg.append("g")
            .selectAll("line")
            .data(links)
            .enter().append("line")
            .attr("class", "link")
            .attr("marker-end", "url(#arrowhead)");

        // Nodes
        const node = svg.append("g")
            .selectAll(".node")
            .data(nodes)
            .enter().append("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        // C√≠rculos dos nodes
        node.append("circle")
            .attr("r", d => {
                if (d.type === "database") return 25;
                if (d.type === "external") return 15;
                if (d.key === "invistto-hub") return 30;
                return 20;
            })
            .attr("fill", d => d.color);

        // Labels
        node.append("text")
            .attr("dy", d => {
                if (d.type === "database") return 40;
                if (d.key === "invistto-hub") return 45;
                return 35;
            })
            .attr("text-anchor", "middle")
            .text(d => d.name);

        // Portas
        node.filter(d => d.port)
            .append("text")
            .attr("dy", 4)
            .attr("text-anchor", "middle")
            .attr("font-size", "8px")
            .attr("fill", "white")
            .text(d => ":" + d.port);

        // Tooltip
        const tooltip = d3.select("#tooltip");

        node.on("mouseover", function(event, d) {
            let content = `<h3>${d.name}</h3>`;
            content += `<p>${d.desc}</p>`;
            if (d.port) content += `<p class="port">Porta: :${d.port}</p>`;
            if (d.stack) content += `<p>Stack: ${d.stack}</p>`;
            if (d.path) content += `<p>Prod: ${d.path}</p>`;

            tooltip.html(content)
                .style("display", "block")
                .style("left", (event.pageX + 15) + "px")
                .style("top", (event.pageY - 10) + "px");
        })
        .on("mouseout", function() {
            tooltip.style("display", "none");
        });

        // Atualiza√ß√£o da simula√ß√£o
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    </script>
</body>
</html>